# 05. 배포 과정

## 5.1 배포 관련 용어

### 5.1.1 무중단/중단배포

- 배포시 서비스 중단 유무에 따라 나뉨
- `중단 배포가 무조건 안좋은 것은 아님`
  - 무중단 배포의 비용이 큰 경우가 존재
  - 과거의 버전과 새로운 버전이 연관도가 있을 때

### 5.1.2 현재 위치 배포

  ![in-place](/resources/in-place.png)
  ![in-place2](/resources/in-place2.png)
  ![in-place3](/resources/in-place3.png)

- 무중단 배포
- 여러대의 서버를 배포할 때, 서버의 수를 늘리거나 줄이지 않고 배포하는 방법
- 장점
  - 간단하고 빠름
- 단점
  - 요청 과부하 주의
  - `롤백의 경우 배포를 다시 해야하므로 대응하는데 시간이 걸리는 편`

### 5.1.3 서버 단위의 블루/그린 배포

  ![bg-1](/resources/bg-1.png)
  ![bg-2](/resources/bg-2.png)

- 무중단 배포
- 인스턴스의 배포 그룹을 나누어 `배포마다 각 그룹으로 전환`
- 장점
  - `구/신 버전이 동시에 떠있는 시간이 매우 짧음`
    - (cf. `원래` 무중단 배포는 구/신 버전이 동시에 떠 있어도 `문제가 없어야 한다.`)
  - `롤백이 매우 빠름`
    - `이전 버전의 그룹은 상태를 유지하고, 로드밸런서에서만 제외되는 것`이기 때문에, 빠르게 구버전으로 변경이 가능
  - 각 인스턴스의 요청의 부하가 증가하지 않는다.

### 5.1.4 서버 내 블루/그린 배포

  ![server-bg](/resources/server-bg.png)

- 서버단위가 아니라 서버 내에 블루/그린 무중단 배포 시스템을 구현하는 것
- nginx, `pm2` 등
- 장점
  - 서버단위의 블루/그린 배포와 동일
- 단점
  - 웹서버가 `내려가면(재시작되면) 안됨`
    - `reload, restart` 잘 구분

### 5장에서의 실습 내용

- 새로운 코드를 받은 인스턴스의 AMI를 하나 더 만들고, 새로운 auto scaling 그룹을 만들어 로드밸런스에 할당
- 기존 auto scaling 그룹 로드밸런스에서 해제